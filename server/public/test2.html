<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - geometries</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        font-family: Monospace;
        background-color: #000;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>

    <script src="js/three.js"></script>

    <script src="js/Detector.js"></script>
    <script src="js/libs/stats.min.js"></script>

    <script>
      if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
      var container, stats;
      var camera, scene, renderer;
      var mesh, geometry;
      var d_mesh, d_geometry, d_geometry_ref;
      
      var nextIndex = 0;

      var clock = new THREE.Clock();

      init();
      animate();
      function init() {
        container = document.createElement( 'div' );
        document.body.appendChild( container );
        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
        camera.position.y = 0;
        scene = new THREE.Scene();
        var light, object;
        scene.add( new THREE.AmbientLight( 0x404040 ) );
        light = new THREE.DirectionalLight( 0xffffff );
        light.position.set( 1, 1, 1 );
        scene.add( light );
        //
        var boardMaterial = new THREE.MeshPhongMaterial( { color: 0xc7aa52, shading: THREE.FlatShading, overdraw: 0.5, shininess: 0 } );
        var whiteMaterial = new THREE.MeshPhongMaterial( { color: 0xdbdad6, shading: THREE.FlatShading, overdraw: 0.5, shininess: 0 } );
        var blackMaterial = new THREE.MeshPhongMaterial( { color: 0x20201d, shading: THREE.FlatShading, overdraw: 0.5, shininess: 0 } );
        // 
        d_geometry_ref = new THREE.SphereGeometry( 10, 8, 8 );
        d_geometry = new THREE.SphereGeometry( 10, 8, 8 );
        d_geometry.dynamic = true;
        d_mesh = new THREE.Mesh( d_geometry, whiteMaterial );
        d_mesh.position.set( 0, 0, 0 );
        scene.add( d_mesh );

        geometry = new THREE.TorusGeometry( 70, 20, 19, 19 );
        geometry.dynamic = true;
        mesh = new THREE.Mesh( geometry, boardMaterial );
        mesh.position.set( 0, 0, 0 );
        scene.add( mesh );
        object = new THREE.AxisHelper( 50 );
        object.position.set( 0, 0, 0 );
        scene.add( object );
        //
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );
        stats = new Stats();
        container.appendChild( stats.dom );
        //
        window.addEventListener( 'resize', onWindowResize, false );
      }
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
      }
      //
      function animate() {
        requestAnimationFrame( animate );
        render();
        stats.update();
      }
      function render() {

        var delta = clock.getDelta();
        var time = clock.getElapsedTime() * 10;
        var timer = Date.now() * 0.0001;
        camera.position.x = Math.cos( timer ) * 300;
        camera.position.z = Math.sin( timer ) * 300;
        camera.lookAt( scene.position );

        if ( d_mesh !== undefined && mesh !== undefined ) {
          console.log(nextIndex);
          d_mesh.position.x = mesh.geometry.vertices[Math.floor(nextIndex)].x;
          d_mesh.position.y = mesh.geometry.vertices[Math.floor(nextIndex)].y;
          d_mesh.position.z = mesh.geometry.vertices[Math.floor(nextIndex)].z;
          if ( nextIndex >= mesh.geometry.vertices.length - 1) {
            nextIndex = 0;
          }
          nextIndex += 0.5;
        }
      
        d_mesh.geometry.verticesNeedUpdate = true;

        mesh.geometry.verticesNeedUpdate = true;
        
        renderer.render( scene, camera );
      }
    </script>

  </body>
</html>
