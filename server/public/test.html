<!DOCTYPE html> 
<html> 
    <head>
        <meta charset=utf-8>
        <title>Testing</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
            #ui {
                position: absolute;
                top: 10px;
                right: 50%;
            }
        </style>

        <script src="js/libs/socket.io.js"></script>
        <script src="js/libs/three.js"></script>
        <script src="js/libs/stats.min.js"></script>

        <script src="js/libs/Detector.js"></script>
        <script src="js/generic_THREE_setup.js"></script>
        <script src="js/custom_THREE_setup.js"></script>
        <script src="js/game_logic.js"></script>
        <script src="js/torus.js"></script>
        <script src="js/mouseOver.js"></script>
        <script src="js/server_communication.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    </head>
    <body>
        <div id="ui">
            <div class="dropdown" style="float: left">
                <button class="btn btn-primary dropdown-toggle" id="menu1" type="button" data-toggle="dropdown">Room
                    <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="join_room(this.innerHTML)">default</a></li>
                    <li role="presentation" class="divider"></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="join_room(this.innerHTML)">Room 0</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="join_room(this.innerHTML)">Room 1</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="join_room(this.innerHTML)">Room 2</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="join_room(this.innerHTML)">Room 3</a></li>
                </ul>
            </div>
            <div class="dropdown" style="float: right">
                <button class="btn btn-primary dropdown-toggle" id="menu1" type="button" data-toggle="dropdown">Role
                    <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="play_as(this.innerHTML)">spectate</a></li>
                    <li role="presentation" class="divider"></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="play_as(this.innerHTML)">black</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="play_as(this.innerHTML)">white</a></li>
                </ul>
            </div>
        </div>

        <script>
            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
            var container, stats;
            var camera, scene, renderer;
            var cameraSettings = {
                unscaled_pos: new THREE.Vector3(1,0,0),
                phi: 0,
                rho: 0,
                rad: 100
            };
            var mouse = new THREE.Vector2();
            var mouseMode = "select";
            var raycaster = new THREE.Raycaster();
            var currentSelection;
            var clock = new THREE.Clock();

            var torus_instance;
            var selection_stone;

            var current_player = -1; // 1 = White, -1 = Black


            init_threejs();
            animate();

            var game_role = 'spectator';
            var game_logic_instance = new game_logic(torus_instance.params.w_seg, torus_instance.params.h_seg);

            function render() {
                var delta = clock.getDelta();
                var time = clock.getElapsedTime() * 10;
                var timer = Date.now() * 0.0001;
                switch (mouseMode) {
                    case "camera":
                        cameraSettings.phi = mouse.x * 4;
                        cameraSettings.rho = -mouse.y;
                        cameraSettings.unscaled_pos.x = Math.cos(cameraSettings.rho) * Math.cos(cameraSettings.phi);
                        cameraSettings.unscaled_pos.z = Math.cos(cameraSettings.rho) * Math.sin(cameraSettings.phi);
                        cameraSettings.unscaled_pos.y = Math.sin(cameraSettings.rho);
                        break;
                    case "select":
                        currentSelection = getSelectedPos(raycaster, torus_instance.mesh, mouse, camera);
                        break;
                }

                if (currentSelection !== -1) {
                    selection_stone.position.copy(torus_instance.get_quad_middle(currentSelection));
                } else {
                    selection_stone.position.set(0,0,0);
                }

                //console.log(currentSelection);
                //console.log(mouse);

                camera.position.copy(cameraSettings.unscaled_pos);
                camera.position.multiplyScalar(cameraSettings.rad);
                camera.lookAt(scene.position);
                renderer.render( scene, camera );

                if (torus_instance && game_logic_instance)
                    torus_instance.updateTorus(game_logic_instance);
            }
        </script>
    </body>
</html>
