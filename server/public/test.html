<!DOCTYPE html> 
<html> 
    <head>
        <meta charset=utf-8>
        <title>Testing</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
        </style>

        <script src="js/libs/socket.io.js"></script>
        <script src="js/libs/three.js"></script>
        <script src="js/libs/stats.min.js"></script>

        <script src="js/libs/Detector.js"></script>
        <script src="js/generic_THREE_setup.js"></script>
        <script src="js/custom_THREE_setup.js"></script>
        <script src="js/game_logic.js"></script>
        <script src="js/torus.js"></script>
        <script src="js/mouseOver.js"></script>
        <script src="js/server_communication.js"></script>
    </head>
    <body>
        <script>
            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
            var container, stats;
            var camera, scene, renderer;
            var cameraSettings = {
                unscaled_pos: new THREE.Vector3(1,0,0),
                phi: 0,
                rho: 0,
                rad: 100
            };
            var mouse = new THREE.Vector2();
            var mouseMode = "select";
            var raycaster = new THREE.Raycaster();
            var currentSelection;
            var clock = new THREE.Clock();

            var torus_instance;
            var selection_stone;

            var current_player = -1; // 1 = White, -1 = Black


            init_threejs();
            animate();

            var game_logic_instance = new game_logic(torus_instance.params.w_seg, torus_instance.params.h_seg);

            function render() {
                var delta = clock.getDelta();
                var time = clock.getElapsedTime() * 10;
                var timer = Date.now() * 0.0001;
                switch (mouseMode) {
                    case "camera":
                        cameraSettings.phi = mouse.x * 4;
                        cameraSettings.rho = -mouse.y;
                        cameraSettings.unscaled_pos.x = Math.cos(cameraSettings.rho) * Math.cos(cameraSettings.phi);
                        cameraSettings.unscaled_pos.z = Math.cos(cameraSettings.rho) * Math.sin(cameraSettings.phi);
                        cameraSettings.unscaled_pos.y = Math.sin(cameraSettings.rho);
                        break;
                    case "select":
                        currentSelection = getSelectedPos(raycaster, torus_instance.mesh, mouse, camera);
                        break;
                }

                if (currentSelection !== -1) {
                    selection_stone.position.copy(torus_instance.get_quad_middle(currentSelection));
                } else {
                    selection_stone.position.set(0,0,0);
                }

                //console.log(currentSelection);
                //console.log(mouse);

                camera.position.copy(cameraSettings.unscaled_pos);
                camera.position.multiplyScalar(cameraSettings.rad);
                camera.lookAt(scene.position);
                renderer.render( scene, camera );

                if (torus_instance && game_logic_instance)
                    torus_instance.updateTorus(game_logic_instance);
            }
        </script>
    </body>
</html>
